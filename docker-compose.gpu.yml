# GPU override â€” layer on top of docker-compose.yml:
#   docker compose -f docker-compose.yml -f docker-compose.gpu.yml --profile ai up -d --build
#
# Prerequisites:
#   - NVIDIA GPU with drivers installed on the host
#   - NVIDIA Container Toolkit (nvidia-ctk)
services:
  worker:
    build:
      context: ./ingestion
      dockerfile: Dockerfile
      args:
        ENABLE_GPU: "true"
    environment:
      ENABLE_AI: "true"
    deploy:
      resources:
        reservations:
          devices:
            - driver: nvidia
              count: 1
              capabilities: [gpu]

  api:
    environment:
      ENABLE_AI: "true"

  ollama:
    deploy:
      resources:
        limits:
          cpus: "${OLLAMA_CPUS:-4}"
        reservations:
          devices:
            - driver: nvidia
              count: 1
              capabilities: [gpu]
