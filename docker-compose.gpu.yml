# GPU override -- enable by adding to .env:
#   COMPOSE_FILE=docker-compose.yml:docker-compose.gpu.yml
#
# Prerequisites:
#   - NVIDIA GPU with drivers installed on the host
#   - NVIDIA Container Toolkit (nvidia-ctk)
services:
  worker:
    build:
      context: ./ingestion
      dockerfile: Dockerfile
      args:
        ENABLE_GPU: "true"
    deploy:
      resources:
        reservations:
          devices:
            - driver: nvidia
              count: 1
              capabilities: [gpu]

  llm:
    deploy:
      resources:
        limits:
          cpus: "${LLM_CPUS:-4}"
          memory: "${LLM_MEMORY:-8g}"
        reservations:
          devices:
            - driver: nvidia
              count: 1
              capabilities: [gpu]
